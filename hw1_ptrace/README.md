# System Call Monitoring via `ptrace()`

## Introduction

이 과제에서는 ptrace를 사용하여 특정 프로그램의 시스템 호출을 모니터링하는 방법을 배웁니다.

Ptrace syscall을 사용하면 하나의 프로세스가 하위 프로세스의 다양한 활동을 모니터링 할 수 있습니다.

자세한 내용은 ptrace의 man 페이지를 읽어야합니다.

https://man7.org/linux/man-pages/man2/ptrace.2.html

다음 코드 샘플은 ptrace ()를 사용하는 방법을 보여줍니다.

먼저 부모와 자식으로 분기됩니다.

자식의 경우 PTRACE_TRACEME로 ptrace를 호출하여 부모가 모니터링 할 수 있도록합니다.

그런 다음 부모 부분에서 syscall 시작 및 종료 이벤트가 도착할 때까지 기다립니다.

이 코드에서는 단순히 호출 된 시스템 호출 수를 계산합니다.

모든 시스템 호출 시작 및 종료를 가로채는 무한 루프가 있습니다.

메인 함수가 종료되기 전에 하위 프로세스 인 date에 의해 호출 된 총 시스템 호출 수를 인쇄합니다.

이 코드를 수정하여 아래 설명 된대로 기능을 확장합니다.

## Requirement

1. 모든 프로그램이 명령 줄 인수로 모니터링되도록 허용합니다.
현재는 'date'명령 만 실행하도록 하드 코딩되어 있습니다. 모든 프로그램을 명령 줄 인수로 지정할 수 있도록 위의 프로그램을 수정해야합니다.

- example1) `$ ./myptrace ps -ef`
- example2) `$ ./myptrace ls`

2. 카운트뿐만 아니라 호출 된 시스템 호출을 식별하고 마지막에 통계를 인쇄합니다.
현재 날짜 프로그램에서 호출 한 총 시스템 호출 수만 인쇄합니다. 정렬 된 목록에서 각 시스템 호출 당 호출 수를 표시하도록 프로그램을 수정해야합니다.

example)
```
$ ./myptrace date
Sun Apr 25 16:39:00 KST 2021
Total number of syscalls: 42
      8 mmap
      6 fstat
      6 close
      4 open
      4 mprotect
      3 read
      3 brk
      3 access
      1 write
      1 munmap
      1 lseek
      1 arch_prctl
      1 execve
```

이 기능을 구현하려면 시스템 호출 번호를 추출하는 방법을 찾아야합니다. 이를 위해 ptrace의 PTRACE_GETREGS 옵션을 연구하십시오. 또한 'struct user_regs_struct'사용을 고려해야합니다.

3. 코드 및 프로그램 이름은 각각 myptrace.c 및 myptrace 여야합니다.

이 과제의 모든 문제를 해결하기위한 단계별 가이드는 제공하지 않습니다. 웹 검색과 공부를 통해 마주 치는 다양한 문제에 대한 해결책을 찾아야합니다.

## Environment

대상 환경은 Linux입니다. 주어진 VM을 사용하여 프로그래밍을 수행 할 수 있습니다.
Visual Studio와 같은 Windows 프로그래밍 환경을 사용하지 마십시오. 이거 작동 안 할거야.
cygiwn xterm을 사용하지 마십시오. 실제 Linux 시스템에 로그인해야합니다. 원하는 경우 Oracle Virtual Box 또는 Vmware Player를 사용하여 Linux VM을 만들 수 있습니다.

## Grading

코드가 먼저 컴파일됩니다. 성공적으로 컴파일되지 않으면 점수는 0이됩니다.

컴플라이언스 중에는 경고가 없어야합니다. 컴파일은 다음으로 수행됩니다.

>`gcc -Wall -o myptrace ./myptrace.c`

각 경고는 -2 점입니다.

이것이 기능의 요점입니다.
1. 명령 줄 인수 처리: 30 점
2. 시스템 호출 통계 출력됨: 50 점
3. 시스템 호출 통계 정확성: 20 점

다양한 프로그램을 사용하여 코드를 테스트하겠습니다. 단순한 ls 또는 ps 명령보다 훨씬 더 복잡 할 수 있습니다.

코드를 철저히 테스트하십시오. 테스트는 매우 중요합니다 !!! 몇 번의 테스트만으로 승리를 선언하지 마십시오.
 
** 질문이 있으시면 아래에 질문하십시오. 여러분 모두 다른 학생들의 질문에 답할 수 있습니다. 질문에 대한 토론과 답변에 적극적인 학생들을 위해 추가 학점을주는 것을 진지하게 고려할 것입니다.

## Submitting your work

LMS에서 myptrace.c 파일 만 제출하면됩니다. 다른 파일은 포함하지 마십시오.
스크린 샷을 제출하지 마십시오.
 
늦은 제출 패널티 : 하루 -10 %.

## Academic Honesty

이것은 1 인 과제입니다. 어떤 상황에서도 소스 코드를 누구와도 공유하지 마십시오. 교과서 또는 인터넷상의 정보 만 사용해야합니다. 친구와 문제를 논의하는 것은 괜찮지 만 코드를 공유하는 것은 괜찮지 않습니다. 다른 사람에게 코드를 보여 주거나 다른 사람의 코드를 보지 마십시오. 어떤 학생들과 나란히 협력하지 마십시오. 유사한 소스 코드를 감지하는 특수 프로그램을 실행하겠습니다. 복사본이 발견되면 공급자와 수신자 모두 F를받습니다.
